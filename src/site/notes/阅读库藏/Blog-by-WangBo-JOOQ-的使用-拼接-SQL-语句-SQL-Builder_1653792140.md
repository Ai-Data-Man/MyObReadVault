---
{"title":"Blog by WangBo - JOOQ çš„ä½¿ç”¨ - æ‹¼æ¥ SQL è¯­å¥ (SQL Builder)","url":"https://www.wangbo.im/posts/jooq-usecases-sql-builder/","clipped_at":"2022-05-29 10:42:20","tags":["æ— "],"dg-publish":true,"permalink":"/é˜…è¯»åº“è—/Blog-by-WangBo-JOOQ-çš„ä½¿ç”¨-æ‹¼æ¥-SQL-è¯­å¥-SQL-Builder_1653792140/","dgPassFrontmatter":true}
---


# Blog by WangBo - JOOQ çš„ä½¿ç”¨ - æ‹¼æ¥ SQL è¯­å¥ (SQL Builder)

[WB Prime](https://www.wangbo.im/)

*   [Categories](https://www.wangbo.im/categories)
*   [Tags](https://www.wangbo.im/tags)
*   [Github](https://github.wangbo.im/)
*   [About](https://www.wangbo.im/about)

# [JOOQ çš„ä½¿ç”¨ - æ‹¼æ¥ SQL è¯­å¥ (SQL Builder)](https://www.wangbo.im/posts/jooq-usecases-sql-builder/)

2019-10-17

[jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") æ˜¯åŸºäº JDBC ä¹‹ä¸Šçš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œæä¾›äº†å¤šç§å¤šæ ·çš„æ¨¡å‹æ¥ä¸å…³ç³»å‹æ•°æ®åº“è¿›è¡Œäº’æ“ä½œï¼›å…¶ä½¿ç”¨ä¸ [mybatis](https://mybatis.org/mybatis-3/) å’Œ [Hibernate ORM](http://hibernate.org/orm/) ä¸åŒçš„æ€è·¯æ¥å®ç° [å¯¹è±¡å…³ç³»æ˜ å°„ ORM](https://en.wikipedia.org/wiki/Object-relational_mapping) ã€‚

æœ¬ç¯‡ä¸»è¦ä»‹ç»åŸºäº [jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") çš„ SQL è¯­å¥æ‹¼æ¥ (SQL Builder) ã€‚

ä¸åŒçš„å…³ç³»å‹æ•°æ®åº“æä¾›æ–¹å¯¹ SQL çš„æ”¯æŒç¨‹åº¦ä¸å®Œå…¨ä¸€è‡´ï¼Œå½¢æˆäº†ä¸åŒçš„ SQL æ–¹è¨€ã€‚ä¸åŒçš„ SQL æ–¹è¨€åœ¨è¯­æ³•çš„ç»†èŠ‚ã€æ”¯æŒçš„æ•°æ®ç±»å‹ç­‰æ–¹é¢å­˜åœ¨å·®åˆ«ï¼›æƒ³è¦æ‰‹å†™å¯ç§»æ¤çš„ SQL ç®€ç›´æ˜¯éš¾äºä¸Šé’å¤©ã€‚

[jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") å¯ä»¥ç”¨æ¥å¸®åŠ©æ„å»º SQL è¯­å¥ï¼Œå¿½ç•¥ä¸åŒ SQL æ–¹è¨€çš„å­˜åœ¨ã€‚

åœ¨ [Maven](https://maven.apache.org/) ä¸­ä½¿ç”¨ [jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.")ï¼Œéœ€è¦åœ¨ `pom.xml` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```plain
<
dependency
>    <
groupId
>
org.jooq
</
groupId
>    <
artifactId
>
jooq
</
artifactId
>    <
version
>
${jooq_version}
</
version
></
dependency
>
```

æˆªè‡³ 2019-10-21ï¼Œ[jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ `3.12.1` ã€‚

ä»¥ä¸‹æ‰€æœ‰çš„ SQL ç”Ÿæˆç”¨ä¾‹éƒ½ä½¿ç”¨äº† [JUnit 5](https://junit.org/junit5/) çš„å‚æ•°åŒ–æµ‹è¯•èƒ½åŠ›ï¼Œå‚æ•°åŒ–çš„æ•°æ®ä¸º 6 ç§ä¸åŒçš„å…³ç³»å‹æ•°æ®åº“æ–¹è¨€ã€‚

å…¬å…±ä»£ç ï¼š

```plain
// junit 5 parameterized test data source
static 
Stream
<
Arguments
> 
dslContexts() 
{    
return 
Stream
.
of(        
Arguments
.of(
SQLDialect
.DEFAULT),        
Arguments
.of(
SQLDialect
.H2),        
Arguments
.of(
SQLDialect
.HSQLDB),        
Arguments
.of(
SQLDialect
.POSTGRES),        
Arguments
.of(
SQLDialect
.MYSQL)    )
;}
```

# [ğŸ”—](#create-table)create table

ä½¿ç”¨ [jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") æ¥ç”Ÿæˆ `create table` çš„ SQLï¼š

```plain
@
ParameterizedTest
@
MethodSource
(
"dslContexts"
)void 
test_buildCreateTable(final 
SQLDialect
 dialect) 
{    
final 
DSLContext
 dsl 
= 
DSL
.
using(dialect)
;    
final 
String
 sql 
=
 dsl        .
createTable(
"user"
)        
.
column(
"id"
,            
DefaultDataType
.getDataType(dialect, 
Long
.class)                .identity(
true
)                .nullable(
false
))        
.
column(
"name"
,            
DefaultDataType
.getDataType(dialect, 
String
.class)                .nullable(
false
)                .length(
100
))        
.
column(
"created_at"
,            
DefaultDataType
.getDataType(dialect, 
LocalDateTime
.class)                .nullable(
false
))        
.
constraint(DSL.primaryKey(
"id"
))        
.
getSQL(
ParamType
.INLINED)
;    
System
.out.
println(dialect.getName() 
+ 
" => " 
+
 sql)
;}
```

ç”Ÿæˆçš„ `create table` è¯­å¥ç®€å•å¯¹æ¯”å¦‚ä¸‹ï¼š

*   [SQL:1999](https://en.wikipedia.org/wiki/SQL:1999 "SQL:1999")
    
    ```plain
    create table
     "
    user
    "(
        
    "id" 
    bigint not null
    ,
        
    "name" 
    varchar
    (
    100
    ) 
    not null
    ,
        
    "created_at" 
    timestamp not null
    ,
        
    primary key
     (
    "id"
    )
    )
    ```
    
*   [H2](http://www.h2database.com/html/main.html "H2 Database Engine")
    
    ```plain
    create table
     "
    user
    "(
        
    "id" 
    bigint not null
     auto_increment,
        
    "name" 
    varchar
    (
    100
    ) 
    not null
    ,
        
    "created_at" 
    timestamp not null
    ,
        
    primary key
     (
    "id"
    )
    )
    ```
    
*   [HSQLDB](http://hsqldb.org/ "HSQLDB - 100% Java Database")
    
    ```plain
    create table
     "
    user
    "(
        
    "id" 
    bigint
     generated by 
    default as
     identity(start 
    with 
    1
    ) 
    not null
    ,
        
    "name" 
    varchar
    (
    100
    ) 
    not null
    ,
        
    "created_at" 
    timestamp not null
    ,
        
    primary key
     (
    "id"
    )
    )
    ```
    
*   [MySQL](http://www.mysql.com/ "The world's most popular open source database")
    
    ```plain
    create table
     `
    user
    `(
        
    `id` 
    bigint not null
     auto_increment,
        
    `name` 
    varchar
    (
    100
    ) 
    not null
    ,
        
    `created_at` 
    timestamp not null
    ,
        
    primary key
     (
    `id`
    )
    )
    ```
    
*   [Postgres](https://www.postgresql.org/ "PostgreSQL: The World's Most Advanced Open Source Relational Database")
    
    ```plain
    create table
     "
    user
    "(
        
    "id"
     serial8 
    not null
    ,
        
    "name" 
    varchar
    (
    100
    ) 
    not null
    ,
        
    "created_at" 
    timestamp not null
    ,
        
    primary key
     (
    "id"
    )
    )
    ```
    

# [ğŸ”—](#select)select

ä½¿ç”¨ [jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") æ¥ç”Ÿæˆ `select` çš„ SQLï¼š

```plain
@
ParameterizedTest
@
MethodSource
(
"dslContexts"
)void 
test_buildSelect(final 
SQLDialect
 dialect) 
{    
final 
DSLContext
 dsl 
= 
DSL
.
using(dialect)
;    
final 
String
 sql 
=
 dsl        .
select(DSL.field(
"u.id"
), DSL.field(
"u.name"
), DSL.field(
"b.book_name"
))        
.
from(DSL.table(
"user"
).as(
"u"
))        
.
join(DSL.table(
"book"
).as(
"b"
))        
.
on(DSL.field(
"u.id"
).eq(DSL.field(
"b.author_id"
)))        
.
where(DSL.field(
"u.name"
).eq(
"Elvis Wang"
))        
.
getSQL(
ParamType
.INLINED)
;    
System
.out.
println(dialect.getName() 
+ 
" => " 
+
 sql)
;}
```

ç”Ÿæˆçš„ `select` è¯­å¥ç®€å•å¯¹æ¯”å¦‚ä¸‹ï¼š

*   [SQL:1999](https://en.wikipedia.org/wiki/SQL:1999 "SQL:1999")
    
    ```plain
    select 
    u
    .
    id
    , 
    u
    .
    name
    , 
    b
    .
    book_name
        
    from
     user 
    "u"
        
    join
     book 
    "b"
        
    on 
    u
    .
    id 
    = 
    b
    .
    author_id
        
    where 
    u
    .
    name 
    = 
    'Elvis Wang'
    ```
    
*   [H2](http://www.h2database.com/html/main.html "H2 Database Engine")
    
    ```plain
    select 
    u
    .
    id
    , 
    u
    .
    name
    , 
    b
    .
    book_name
        
    from
     user 
    "u"
        
    join
     book 
    "b"
        
    on 
    u
    .
    id 
    = 
    b
    .
    author_id
        
    where 
    u
    .
    name 
    = 
    'Elvis Wang'
    ```
    
*   [HSQLDB](http://hsqldb.org/ "HSQLDB - 100% Java Database")
    
    ```plain
    select 
    u
    .
    id
    , 
    u
    .
    name
    , 
    b
    .
    book_name
        
    from
     user 
    as 
    "u"
        
    join
     book 
    as 
    "b"
        
    on 
    u
    .
    id 
    = 
    b
    .
    author_id
        
    where 
    u
    .
    name 
    = 
    'Elvis Wang'
    ```
    
*   [MySQL](http://www.mysql.com/ "The world's most popular open source database")
    
    ```plain
    select 
    u
    .
    id
    , 
    u
    .
    name
    , 
    b
    .
    book_name
        
    from
     user 
    as
     \
    `u\`
        join book as \`b\`
        on u.id = b.author_id
        where u.name = 'Elvis Wang'
    ```
    
*   [Postgres](https://www.postgresql.org/ "PostgreSQL: The World's Most Advanced Open Source Relational Database")
    
    ```plain
    select 
    u
    .
    id
    , 
    u
    .
    name
    , 
    b
    .
    book_name
        
    from
     user 
    as 
    "u"
        
    join
     book 
    as 
    "b"
        
    on 
    u
    .
    id 
    = 
    b
    .
    author_id
        
    where 
    u
    .
    name 
    = 
    'Elvis Wang'
    ```
    

# [ğŸ”—](#insert)insert

ä½¿ç”¨ [jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") æ¥ç”Ÿæˆ `insert` çš„ SQLï¼š

```plain
@
ParameterizedTest
@
MethodSource
(
"dslContexts"
)void 
test_buildInsert(final 
SQLDialect
 dialect) 
{    
final 
DSLContext
 dsl 
= 
DSL
.
using(dialect)
;    
final 
String
 sql 
=
 dsl        .
insertInto(DSL.table(
"user"
))        
.
columns(DSL.field(
"name"
), DSL.field(
"created_at"
))        
.
values(DSL.value(
"Elvis Wang"
), DSL.value(
LocalDateTime
.now()))        
.
getSQL(
ParamType
.INLINED)
;    
System
.out.
println(dialect.getName() 
+ 
" => " 
+
 sql)
;}
```

ç”Ÿæˆçš„ `insert` è¯­å¥ç®€å•å¯¹æ¯”å¦‚ä¸‹ï¼š

*   [SQL:1999](https://en.wikipedia.org/wiki/SQL:1999 "SQL:1999")
    
    ```plain
    insert into
     user (name, created_at)
        
    values
     (
            
    'Elvis Wang'
    ,
            
    timestamp 
    '2019-10-17 18:28:29.305'
        )
    ```
    
*   [H2](http://www.h2database.com/html/main.html "H2 Database Engine")
    
    ```plain
    insert into
     user (name, created_at)
        
    values
     (
            
    'Elvis Wang'
    ,
            
    timestamp 
    '2019-10-17 18:28:29.332'
        )
    ```
    
*   [HSQLDB](http://hsqldb.org/ "HSQLDB - 100% Java Database")
    
    ```plain
    insert into
     user (name, created_at)
        
    values
     (
            
    'Elvis Wang'
    ,
            
    timestamp 
    '2019-10-17 18:28:29.335'
        )
    ```
    
*   [MySQL](http://www.mysql.com/ "The world's most popular open source database")
    
    ```plain
    insert into
     user (name, created_at)
        
    values
     (
            
    'Elvis Wang'
    ,
            {ts 
    '2019-10-17 18:28:29.338'
    }
        )
    ```
    
*   [Postgres](https://www.postgresql.org/ "PostgreSQL: The World's Most Advanced Open Source Relational Database")
    
    ```plain
    insert into
     user (name, created_at)
        
    values
     (
            
    'Elvis Wang'
    ,
            
    timestamp 
    '2019-10-17 18:28:29.341'
        )
    ```
    

# [ğŸ”—](#update)update

ä½¿ç”¨ [jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") æ¥ç”Ÿæˆ `update` çš„ SQLï¼š

```plain
@
ParameterizedTest
@
MethodSource
(
"dslContexts"
)void 
test_buildUpdate(final 
SQLDialect
 dialect) 
{    
final 
DSLContext
 dsl 
= 
DSL
.
using(dialect)
;    
final 
String
 sql 
=
 dsl        .
update(DSL.table(
"user"
))        
.
set(DSL.field(
"name"
), 
"Elvis Wang"
)        
.
set(DSL.field(
"created_at"
), 
LocalDateTime
.now())        
.
where(DSL.field(
"id"
).eq(
1993
L
))        
.
getSQL(
ParamType
.INLINED)
;    
System
.out.
println(dialect.getName() 
+ 
" => " 
+
 sql)
;}
```

ç”Ÿæˆçš„ `update` è¯­å¥ç®€å•å¯¹æ¯”å¦‚ä¸‹ï¼š

*   [SQL:1999](https://en.wikipedia.org/wiki/SQL:1999 "SQL:1999")
    
    ```plain
    update
     user
        
    set
     name 
    = 
    'Elvis Wang'
    ,
            created_at 
    = 
    timestamp 
    '2019-10-17 19:46:58.42'
        
    where
     id 
    = 
    1993
    ```
    
*   [H2](http://www.h2database.com/html/main.html "H2 Database Engine")
    
    ```plain
    update
     user
        
    set
     name 
    = 
    'Elvis Wang'
    ,
            created_at 
    = 
    timestamp 
    '2019-10-17 19:46:58.456'
        
    where
     id 
    = 
    1993
    ```
    
*   [HSQLDB](http://hsqldb.org/ "HSQLDB - 100% Java Database")
    
    ```plain
    update
     user
        
    set
     name 
    = 
    'Elvis Wang'
    ,
            created_at 
    = 
    timestamp 
    '2019-10-17 19:46:58.46'
        
    where
     id 
    = 
    1993
    ```
    
*   [MySQL](http://www.mysql.com/ "The world's most popular open source database")
    
    ```plain
    update
     user
        
    set
     name 
    = 
    'Elvis Wang'
    ,
            created_at 
    =
     {ts 
    '2019-10-17 19:46:58.462'
    }
        
    where
     id 
    = 
    1993
    ```
    
*   [Postgres](https://www.postgresql.org/ "PostgreSQL: The World's Most Advanced Open Source Relational Database")
    
    ```plain
    update
     user
        
    set
     name 
    = 
    'Elvis Wang'
    ,
            created_at 
    = 
    timestamp 
    '2019-10-17 19:46:58.465'
        
    where
     id 
    = 
    1993
    ```
    

# [ğŸ”—](#delete)delete

ä½¿ç”¨ [jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") æ¥ç”Ÿæˆ `delete` çš„ SQLï¼š

```plain
@
ParameterizedTest
@
MethodSource
(
"dslContexts"
)void 
test_buildDelete(final 
SQLDialect
 dialect) 
{    
final 
DSLContext
 dsl 
= 
DSL
.
using(dialect)
;    
final 
String
 sql 
=
 dsl        .
delete(DSL.table(
"user"
))        
.
where(DSL.field(
"id"
).eq(
1993
L
))        
.
getSQL(
ParamType
.INLINED)
;    
System
.out.
println(dialect.getName() 
+ 
" => " 
+
 sql)
;}
```

ç”Ÿæˆçš„ `delete` è¯­å¥ç®€å•å¯¹æ¯”å¦‚ä¸‹ï¼š

*   [SQL:1999](https://en.wikipedia.org/wiki/SQL:1999 "SQL:1999")
    
    ```plain
    delete from
     user 
    where
     id 
    = 
    1993
    ```
    
*   [H2](http://www.h2database.com/html/main.html "H2 Database Engine")
    
    ```plain
    delete from
     user 
    where
     id 
    = 
    1993
    ```
    
*   [HSQLDB](http://hsqldb.org/ "HSQLDB - 100% Java Database")
    
    ```plain
    delete from
     user 
    where
     id 
    = 
    1993
    ```
    
*   [MySQL](http://www.mysql.com/ "The world's most popular open source database")
    
    ```plain
    delete from
     user 
    where
     id 
    = 
    1993
    ```
    
*   [Postgres](https://www.postgresql.org/ "PostgreSQL: The World's Most Advanced Open Source Relational Database")
    
    ```plain
    delete from
     user 
    where
     id 
    = 
    1993
    ```
    

* * *

å®Œæ•´çš„ç¤ºä¾‹ä»£ç å¯ä»¥å‚è§ [jOOQ Usecases](https://github.com/wbprime/java-mods/tree/master/jooq-usecases) ã€‚

æƒ³äº†è§£æ›´å¤šçš„ [jOOQ](https://www.jooq.org/ "jOOQ generates Java code from your database and lets you build type safe SQL queries through its fluent API.") ç”¨æ³•ï¼Œå¯ä»¥é˜…è¯» [å®˜æ–¹æ–‡æ¡£](https://www.jooq.org/learn/ "jOOQ Documentation") ã€‚

* * *

ä»¥ä¸Šã€‚

[#jdbc](https://www.wangbo.im/tags/jdbc/) [#sql](https://www.wangbo.im/tags/sql/) [#jooq](https://www.wangbo.im/tags/jooq/)

[â€¹ Mapper Classes Generated by MapStruct](https://www.wangbo.im/posts/mapstruct-usecases/) [JOOQ çš„ä½¿ç”¨ - æ‰§è¡Œ SQL è¯­å¥ (SQL Executor) â€º](https://www.wangbo.im/posts/jooq-usecases-sql-executor/)